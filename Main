<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=<?php
session_start();

// ========== Data ==========
$library = [
    "Fantasy" => ["Harry Potter", "The Hobbit"],
    "Mystery" => ["Sherlock Holmes", "Gone Girl"],
    "Non-Fiction" => [
        "Science" => ["A Brief History of Time", "The Selfish Gene"],
        "Biography" => ["Steve Jobs", "Becoming"]
    ]
];

if (!isset($_SESSION['bookInfo'])) {
    $_SESSION['bookInfo'] = [
        "Harry Potter" => ["author" => "J.K. Rowling", "year" => 1997, "genre" => "Fantasy"],
        "The Hobbit" => ["author" => "J.R.R. Tolkien", "year" => 1937, "genre" => "Fantasy"],
        "Gone Girl" => ["author" => "Gillian Flynn", "year" => 2012, "genre" => "Mystery"],
        "A Brief History of Time" => ["author" => "Stephen Hawking", "year" => 1988, "genre" => "Science"],
        "The Selfish Gene" => ["author" => "Richard Dawkins", "year" => 1976, "genre" => "Science"],
        "Steve Jobs" => ["author" => "Walter Isaacson", "year" => 2011, "genre" => "Biography"],
        "Becoming" => ["author" => "Michelle Obama", "year" => 2018, "genre" => "Biography"],
        "Sherlock Holmes" => ["author" => "Arthur Conan Doyle", "year" => 1892, "genre" => "Mystery"]
    ];
}

$bookInfo = $_SESSION['bookInfo'];

// ========== Recursive Display ==========
function displayLibrary($library) {
    echo '<ul class="list-group">';
    foreach ($library as $category => $items) {
        echo '<li class="list-group-item">';
        echo "<strong>$category</strong>";
        if (is_array($items)) {
            echo '<div class="ms-3 mt-2">';
            if (array_values($items) === $items) {
                foreach ($items as $book) {
                    echo "<p class='mb-1 text-secondary'><i class='bi bi-book'></i> $book</p>";
                }
            } else {
                displayLibrary($items);
            }
            echo '</div>';
        }
        echo '</li>';
    }
    echo '</ul>';
}

// ========== Hash Table Lookup ==========
function getBookInfoHTML($title, $bookInfo) {
    if (isset($bookInfo[$title])) {
        $info = $bookInfo[$title];
        return "
        <div class='card mb-3 border-0 shadow-sm'>
            <div class='card-body'>
                <h5 class='card-title'>$title</h5>
                <p><strong>Author:</strong> {$info['author']}</p>
                <p><strong>Year:</strong> {$info['year']}</p>
                <p><strong>Genre:</strong> {$info['genre']}</p>
            </div>
        </div>";
    } else {
        return "<div class='alert alert-warning'>Book not found.</div>";
    }
}

// ========== BST ==========
class Node {
    public $data;
    public $left;
    public $right;
    public function __construct($data) { $this->data = $data; }
}
class BST {
    public $root = null;
    private function insertRec($node, $data) {
        if (!$node) return new Node($data);
        if ($data < $node->data) $node->left = $this->insertRec($node->left, $data);
        elseif ($data > $node->data) $node->right = $this->insertRec($node->right, $data);
        return $node;
    }
    public function insert($data) {
        $this->root = $this->insertRec($this->root, $data);
    }
    private function inorder($node, &$arr) {
        if ($node) {
            $this->inorder($node->left, $arr);
            $arr[] = $node->data;
            $this->inorder($node->right, $arr);
        }
    }
    public function getInorder() {
        $arr = [];
        $this->inorder($this->root, $arr);
        return $arr;
    }
}

$bst = new BST();
foreach ($bookInfo as $title => $info) $bst->insert($title);
$booksSorted = $bst->getInorder();

$result = "";
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['book_title'])) {
    $title = trim($_POST['book_title']);
    $result = getBookInfoHTML($title, $bookInfo);
}

// ======= CRUD Operations =======
if (isset($_POST['action'])) {
    $action = $_POST['action'];
    $title = trim($_POST['title']);
    $author = trim($_POST['author']);
    $year = trim($_POST['year']);
    $genre = trim($_POST['genre']);

    switch ($action) {
        case 'create':
            if (!isset($_SESSION['bookInfo'][$title])) {
                $_SESSION['bookInfo'][$title] = [
                    'author' => $author,
                    'year' => $year,
                    'genre' => $genre
                ];
            }
            break;
        case 'update':
            if (isset($_SESSION['bookInfo'][$title])) {
                $_SESSION['bookInfo'][$title] = [
                    'author' => $author,
                    'year' => $year,
                    'genre' => $genre
                ];
            }
            break;
        case 'delete':
            unset($_SESSION['bookInfo'][$title]);
            break;
    }
    header("Location: " . $_SERVER['PHP_SELF']);
    exit();
}
?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Digital Library Organizer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { font-family: "Poppins", sans-serif; background: #f9fafb; color: #333; }
        h2 { font-weight: 600; letter-spacing: -0.5px; }
        .card { border: none; border-radius: 14px; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05); }
        .card-header { font-weight: 600; }
        .list-group-item { border: none; padding: .6rem .8rem; background: transparent; }
        .list-group-item:hover { background: #f1f5f9; }
        input[type="text"], input[type="number"] { border-radius: 10px; padding: .5rem 1rem; }
    </style>
</head>
<body>

<div class="container py-4">
    <h2 class="mb-4 text-center text-primary"><i class="bi bi-journal-bookmark"></i> Digital Library Organizer</h2>

    <div class="row g-4">
        <div class="col-lg-5">
            <div class="card">
                <div class="card-header bg-primary text-white">üìö Library Categories (Recursion)</div>
                <div class="card-body">
                    <?php displayLibrary($library); ?>
                </div>
            </div>
        </div>

        <div class="col-lg-7">
            <div class="card mb-3">
                <div class="card-header bg-success text-white">üîç Book Lookup</div>
                <div class="card-body">
                    <form method="POST" class="row g-2">
                        <div class="col-8"><input type="text" name="book_title" class="form-control" placeholder="Enter book title..." required></div>
                        <div class="col-4"><button type="submit" class="btn btn-success w-100">Search</button></div>
                    </form>
                    <div class="mt-3"><?= $result ?></div>
                </div>
            </div>

            <div class="card mb-3">
                <div class="card-header bg-info text-white">üå≥ Binary Search Tree (Alphabetical)</div>
                <div class="card-body">
                    <div class="d-flex flex-wrap gap-2">
                        <?php foreach ($booksSorted as $book): ?>
                            <span class="badge bg-secondary"><?= $book ?></span>
                        <?php endforeach; ?>
                    </div>
                </div>
            </div>

            <!-- CRUD SECTION and Operation -->
            <div class="card">
                <div class="card-header bg-dark text-white">‚öôÔ∏è Manage Books (CRUD)</div>
                <div class="card-body">
                    <form method="POST" class="row g-2 mb-3">
                        <input type="hidden" name="action" value="create">
                        <div class="col-md-3"><input type="text" name="title" placeholder="Title" class="form-control" required></div>
                        <div class="col-md-3"><input type="text" name="author" placeholder="Author" class="form-control" required></div>
                        <div class="col-md-2"><input type="number" name="year" placeholder="Year" class="form-control" required></div>
                        <div class="col-md-2"><input type="text" name="genre" placeholder="Genre" class="form-control" required></div>
                        <div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Add</button></div>
                    </form>

                    <table class="table table-sm table-bordered align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Title</th><th>Author</th><th>Year</th><th>Genre</th><th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php foreach ($_SESSION['bookInfo'] as $title => $info): ?>
                            <tr>
                                <td><?= $title ?></td>
                                <td><?= $info['author'] ?></td>
                                <td><?= $info['year'] ?></td>
                                <td><?= $info['genre'] ?></td>
                                <td>
                                    <form method="POST" class="d-inline">
                                        <input type="hidden" name="action" value="delete">
                                        <input type="hidden" name="title" value="<?= $title ?>">
                                        <button type="submit" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i></button>
                                    </form>
                                </td>
                            </tr>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
</html>
